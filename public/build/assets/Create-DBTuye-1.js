import{r as m,j as e,G as Se,S as Me,V as M,a as ke,A as de}from"./app-C7HmzJUd.js";import{F as Ee,g as Ce}from"./translations-Cp8Ohmwm.js";import{I as q}from"./InputError-DCJj3MAo.js";import{I as E}from"./InputLabel-Bw2gduTy.js";import{T as W}from"./TextInput-CsgndSGw.js";import{T as J}from"./TextArea-e4wNS-y9.js";import{P as Fe}from"./PrimaryButton-D6cUMsYk.js";import{S as Ie}from"./SignatureCanvas-Cwq31zLN.js";const qe={medium:{maxWidth:1920,maxHeight:1080,quality:.5,maxSizeKB:500,format:"image/jpeg",minSizeForCompressionMB:2}},ce={tier1:{minSizeMB:2,maxSizeMB:5,quality:.7,description:"50% compression"},tier2:{minSizeMB:5,maxSizeMB:8,quality:.6,description:"60% compression"},tier3:{minSizeMB:8,maxSizeMB:1/0,quality:.5,description:"70% compression"}},Q=.7,me=qe.medium,Re=10,ze=a=>{if(a<2)return null;for(const d of Object.values(ce))if(a>=d.minSizeMB&&a<d.maxSizeMB)return d;return ce.tier3},Pe=async(a,d={})=>{const{maxWidth:u=1920,maxHeight:g=1080,maxSizeKB:_=500,format:f="image/jpeg"}=d,S=a.size/(1024*1024),o=ze(S);return o?(console.log(`File ${a.name} is ${S.toFixed(2)}MB, applying ${o.description}`),new Promise((j,D)=>{const R=document.createElement("canvas"),y=R.getContext("2d"),b=new Image;b.onload=()=>{try{let k=u,z=g;S>8?(k=Math.min(u,1280),z=Math.min(g,720)):S>5&&(k=Math.min(u,1600),z=Math.min(g,900));const{width:A,height:P}=Le(b.width,b.height,k,z);R.width=A,R.height=P,y.drawImage(b,0,0,A,P),R.toBlob(async $=>{if(!$){D(new Error("Failed to compress image"));return}let C=$,v=o.quality;const x=a.size*(1-Q);for(;C.size>_*1024&&C.size>x&&v>.3;){v-=.05;const B=await new Promise(T=>{R.toBlob(T,f,v)});if(B.size>=x)C=B;else break}const L=new File([C],a.name,{type:f,lastModified:Date.now()}),N=(a.size-L.size)/a.size*100;console.log(`Compressed ${a.name}: ${S.toFixed(2)}MB → ${(L.size/(1024*1024)).toFixed(2)}MB (${N.toFixed(1)}% compression)`),N>Q*100&&console.warn(`Warning: Compression ratio ${N.toFixed(1)}% exceeds maximum ${Q*100}%`),j(L)},f,o.quality)}catch(k){D(k)}},b.onerror=()=>{D(new Error("Failed to load image"))},b.src=URL.createObjectURL(a)})):(console.log(`File ${a.name} is ${S.toFixed(2)}MB, keeping original (under 2MB)`),a)},Le=(a,d,u,g)=>{let _=a,f=d;const S=u/a,o=g/d,j=Math.min(S,o,1);return _=Math.round(a*j),f=Math.round(d*j),{width:_,height:f}},Be=async(a,d={},u=null)=>{const g=[],_={tier1:0,tier2:0,tier3:0,unchanged:0};for(let f=0;f<a.length;f++)try{const o=a[f].size/(1024*1024),j=await Pe(a[f],d);g.push(j),o<2?_.unchanged++:o<5?_.tier1++:o<8?_.tier2++:_.tier3++,u&&u({current:f+1,total:a.length,percentage:Math.round((f+1)/a.length*100),compressionStats:_})}catch(S){console.error(`Failed to compress image ${a[f].name}:`,S),g.push(a[f]),_.unchanged++}return g},ee=a=>{if(a===0)return"0 Bytes";const d=1024,u=["Bytes","KB","MB","GB"],g=Math.floor(Math.log(a)/Math.log(d));return parseFloat((a/Math.pow(d,g)).toFixed(2))+" "+u[g]},De=a=>["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type.toLowerCase()),$e=({label:a,images:d=[],onChange:u,error:g,required:_=!1,maxImages:f=Re,compressionOptions:S={},t:o=j=>j})=>{const[j,D]=m.useState(!1),[R,y]=m.useState(0),[b,k]=m.useState(null),z=m.useRef(null),A={...me,...S},P=async v=>{const x=Array.from(v.target.files);if(x.length===0)return;if(x.filter(N=>!De(N)).length>0){alert(o("invalidFileTypes")||"Please select only image files (JPEG, PNG, WebP, GIF)");return}if(d.length+x.length>f){alert(o("tooManyImages")||`Maximum ${f} images allowed`);return}D(!0),y(0),k(null);try{const N=x.reduce((h,O)=>h+O.size,0),B=await Be(x,A,h=>{y(h.percentage)}),T=B.reduce((h,O)=>h+O.size,0);k({originalSize:ee(N),compressedSize:ee(T),savings:N>T?Math.round((N-T)/N*100):0,tier1:x.filter(h=>h.size>=2*1024*1024&&h.size<5*1024*1024).length,tier2:x.filter(h=>h.size>=5*1024*1024&&h.size<8*1024*1024).length,tier3:x.filter(h=>h.size>=8*1024*1024).length,unchanged:x.filter(h=>h.size<2*1024*1024).length});const X=d.map(h=>`${h.name}_${h.size}`),U=B.filter(h=>{const O=`${h.name}_${h.size}`;return!X.includes(O)}),V=[...d,...U];console.log("Selected files:",x.length),console.log("Compressed files:",B.length),console.log("Unique compressed files:",U.length),console.log("Total images after update:",V.length),u(V)}catch(N){console.error("Error compressing images:",N),alert(o("compressionError")||"Error compressing images. Please try again.")}finally{D(!1),y(0),z.current&&(z.current.value="")}},$=v=>{const x=[...d],L=x[v];if(L&&typeof L=="object")try{URL.revokeObjectURL(URL.createObjectURL(L))}catch{}x.splice(v,1),u(x)},C=()=>{u([]),k(null)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"image-upload",value:a,className:"font-medium"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:o("uploadPhotosInstructions")||"Upload photos of any size. Automatic compression: 2-5MB (50%), 5-8MB (60%), 8MB+ (70% max)."}),e.jsxs("div",{className:"mt-2",children:[e.jsx("input",{ref:z,type:"file",id:"image-upload",accept:"image/*",multiple:!0,onChange:P,disabled:j||d.length>=f,className:"block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 disabled:opacity-50 disabled:cursor-not-allowed",required:_&&d.length===0}),g&&e.jsx(q,{message:o(g),className:"mt-2"}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[d.length,"/",f," ",o("imagesSelected")||"images selected",d.length>=f&&e.jsxs("span",{className:"text-amber-600 ml-2",children:["(",o("maxImagesReached")||"Maximum reached",")"]})]})]})]}),j&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-blue-800",children:o("compressingImages")||"Compressing images..."}),e.jsxs("span",{className:"text-sm text-blue-600",children:[R,"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${R}%`}})})]}),b&&!j&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:o("processingComplete")||"Processing Complete"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-xs text-green-600",children:[b.originalSize," → ",b.compressedSize,"(",b.savings,"% ",o("smaller")||"smaller",")"]}),b.unchanged>0&&e.jsxs("p",{className:"text-xs text-gray-600",children:[b.unchanged," ",o("filesUnder2MB")||"files under 2MB (kept original)"]}),b.tier1>0&&e.jsxs("p",{className:"text-xs text-blue-600",children:[b.tier1," ",o("files2to5MB")||"files 2-5MB (50% compression)"]}),b.tier2>0&&e.jsxs("p",{className:"text-xs text-orange-600",children:[b.tier2," ",o("files5to8MB")||"files 5-8MB (60% compression)"]}),b.tier3>0&&e.jsxs("p",{className:"text-xs text-red-600",children:[b.tier3," ",o("filesOver8MB")||"files over 8MB (80% compression)"]})]})]}),e.jsx("div",{className:"text-green-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})}),d.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[o("uploadedImages")||"Uploaded Images",": ",d.length]}),d.length>1&&e.jsx("button",{type:"button",onClick:C,className:"text-sm text-red-600 hover:text-red-800 underline",children:o("removeAll")||"Remove All"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:d.map((v,x)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square border border-gray-300 rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:URL.createObjectURL(v),alt:`${o("propertyImage")||"Property image"} ${x+1}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black bg-opacity-75 text-white text-xs p-1 rounded-b-lg opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("div",{className:"truncate",children:v.name}),e.jsx("div",{children:ee(v.size)})]}),e.jsx("button",{type:"button",onClick:()=>$(x),className:"absolute -top-2 -right-2 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-lg transition-colors","aria-label":`${o("removeImage")||"Remove image"} ${x+1}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},x))})]})]})};function Ze(a){const[d,u]=m.useState(""),[g,_]=m.useState("draw"),[f,S]=m.useState(!1),[o,j]=m.useState(a.language||"en"),[D,R]=m.useState(!0),y=m.useRef(null),[b,k]=m.useState({}),[z,A]=m.useState(!1),[P,$]=m.useState(!1),[C,v]=m.useState(!1),x=a.hideEmergencyOption||!1,L=a.isEmergency||!1,[N,B]=m.useState({x:0,y:0}),[T,X]=m.useState({x:0,y:0}),[U,V]=m.useState(!1),[h,O]=m.useState(!1),[G,se]=m.useState({x:0,y:0}),Z=m.useRef(null),H=m.useRef(null);m.useEffect(()=>{P||B({x:0,y:0}),C||X({x:0,y:0})},[P,C]);const ue=s=>{if(Z.current&&s.target.closest(".modal-header")){V(!0);const r=Z.current.getBoundingClientRect();se({x:s.clientX-r.left,y:s.clientY-r.top})}},ge=s=>{if(H.current&&s.target.closest(".modal-header")){O(!0);const r=H.current.getBoundingClientRect();se({x:s.clientX-r.left,y:s.clientY-r.top})}},te=s=>{U?B({x:s.clientX-G.x,y:s.clientY-G.y}):h&&X({x:s.clientX-G.x,y:s.clientY-G.y})},re=()=>{V(!1),O(!1)};m.useEffect(()=>{if(P||C)return document.addEventListener("mousemove",te),document.addEventListener("mouseup",re),()=>{document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",re)}},[P,C,U,h,G]),m.useEffect(()=>{(async()=>{try{R(!0);const r=await ke.get(route("maintenance.check-session"));r.data&&r.data.has_submission&&(M.success("You have already submitted a maintenance request"),de.visit(route("maintenance.thanks")))}catch(r){console.error("Error checking form submission:",r)}finally{R(!1)}})()},[]),m.useEffect(()=>{if(a.language&&["en","es"].includes(a.language)){j(a.language),sessionStorage.setItem("maintenance_form_language",a.language);return}const r=new URLSearchParams(window.location.search).get("lang"),p=sessionStorage.getItem("maintenance_form_language");r&&["en","es"].includes(r)?(j(r),sessionStorage.setItem("maintenance_form_language",r)):p&&["en","es"].includes(p)&&j(p)},[a.language]),m.useEffect(()=>{sessionStorage.setItem("maintenance_form_language",o)},[o]);const t=s=>Ce(o,s);m.useEffect(()=>{y.current&&(y.current.clear(),y.current.penColor="black",y.current.velocityFilterWeight=.4,y.current.minWidth=.5,y.current.maxWidth=2.5,y.current.dotSize=2,y.current.throttle=5)},[g]);const{data:n,setData:w,post:he,processing:K,errors:xe,reset:Te}=Se({building_name:"",unit_number:"",tenant_name:"",tenant_email:"",tenant_phone:"",work_requested:"",is_emergency:L,permission_to_enter:!0,scheduled_date:"",scheduled_time:"",special_instructions:"",tenant_signature:"",signature_file:null,property_images:[],selected_language:o,no_permission_reason:""});m.useEffect(()=>{w("selected_language",o)},[o]);const pe=(s,r)=>{if(!s||!r)return!1;try{const p=`${s}T00:00:00`,c=new Date(p).getDay();if(c===0||c===6)return!1;const[l,Y]=r.split(":").map(Number);return l>=9&&l<17||l===17&&Y===0}catch(p){return console.error("Date validation error:",p),!1}},ne=s=>{s===!1?$(!0):(w("permission_to_enter",!0),w("no_permission_reason",""))},fe=()=>{if(n.no_permission_reason.trim()===""){M.error(t("reasonRequired"));return}w("permission_to_enter",!1),$(!1)},ae=()=>{$(!1),w("permission_to_enter",!0),w("no_permission_reason","")},ie=s=>{s===!0?v(!0):w("is_emergency",!1)},be=()=>{w("is_emergency",!0),v(!1)},oe=()=>{v(!1),w("is_emergency",!1)},ye=()=>{const s={};if(n.building_name||(s.building_name="buildingRequired"),n.unit_number||(s.unit_number="unitRequired"),n.tenant_name||(s.tenant_name="nameRequired"),n.tenant_email||(s.tenant_email="emailRequired"),n.tenant_phone||(s.tenant_phone="phoneRequired"),n.work_requested||(s.work_requested="workRequestRequired"),n.work_requested&&n.work_requested.length>300&&(s.work_requested="workRequestTooLong"),n.scheduled_date||(s.scheduled_date="dateRequired"),n.scheduled_time||(s.scheduled_time="timeRequired"),(!n.property_images||n.property_images.length===0)&&(s.property_images="propertyImagesRequired"),n.tenant_email&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n.tenant_email)&&(s.tenant_email="emailInvalid"),n.tenant_phone){const r=n.tenant_phone.replace(/\D/g,"");(r.length<7||r.length>15)&&(s.tenant_phone="phoneInvalid")}return n.scheduled_date&&n.scheduled_time&&(pe(n.scheduled_date,n.scheduled_time)||(s.scheduled_time="schedulingInvalid")),s},F=(s,r)=>{w(s,r),z&&k(p=>{const i={...p};return delete i[s],i})},_e=s=>{s.preventDefault();const r=ye();if(k(r),A(!0),Object.keys(r).length>0){M.error(t("fixFormErrors"));const l=document.querySelector(".text-red-600");l&&l.scrollIntoView({behavior:"smooth",block:"center"});return}if(g==="draw"){if(!y.current||y.current.isEmpty()){u(t("signatureRequired")),M.error(t("signatureRequired")),document.getElementById("signature-section").scrollIntoView({behavior:"smooth",block:"center"});return}}else if(g==="upload"&&!n.signature_file){u(t("signatureUploadRequired")),M.error(t("signatureUploadRequired")),document.getElementById("signature-section").scrollIntoView({behavior:"smooth",block:"center"});return}u("");const p=M.loading(t("submitting")),i=document.querySelector('button[type="submit"]');i&&(i.disabled=!0,i.textContent=t("submitting"));const c=new FormData;if(Object.keys(n).forEach(l=>{l!=="signature_file"&&l!=="tenant_signature"&&l!=="property_images"&&c.append(l,n[l])}),n.signature_file instanceof File&&(c.append("signature_file",n.signature_file),console.log("Added signature file to form data")),g==="draw"&&y.current)try{const l=y.current.toDataURL("image/png",1);if(!l||l.length<100||!l.startsWith("data:image/"))throw console.error("Invalid signature data",{isEmpty:!l,length:l?l.length:0,prefix:l?l.substring(0,30):"none"}),new Error(t("invalidSignatureData"));console.log("Signature data captured",{prefix:l.substring(0,30)+"...",length:l.length}),c.append("tenant_signature",l),le(c,i,p)}catch(l){je(l,i,p);return}else le(c,i,p)},je=(s,r,p)=>{var c;console.error("Error capturing signature:",s);const i=t("signatureError");u(i),M.error(i),M.dismiss(p),r&&(r.disabled=!1,r.textContent=t("submitRequest")),(c=document.getElementById("signature-section"))==null||c.scrollIntoView({behavior:"smooth",block:"center"})},le=(s,r,p)=>{n.property_images&&n.property_images.length>0&&n.property_images.forEach((i,c)=>{i instanceof File&&s.append(`property_image_${c}`,i)}),s.append("selected_language",o),console.log("Submitting form with language:",o),console.log("Form data contains selected_language:",s.get("selected_language")),console.log("Form data entries:");for(let[i,c]of s.entries())i==="selected_language"&&console.log(`${i}: ${c}`);he(route("maintenance.store"),{data:s,forceFormData:!0,preserveState:!1,onProgress:i=>{console.log("Upload progress:",i)},onSuccess:i=>{M.success(t("requestSubmitted")),M.dismiss(p);const c=new URL((i==null?void 0:i.redirect)||route("maintenance.thanks"));c.searchParams.set("lang",o),r&&(r.disabled=!0,r.textContent=t("redirecting"));try{de.visit(c.toString()),setTimeout(()=>{document.location.pathname!==new URL(c).pathname&&(window.location.href=c.toString())},1e3),setTimeout(()=>{document.location.pathname!==new URL(c).pathname&&window.location.replace(c.toString())},2e3)}catch(l){console.error("Navigation error:",l),window.location.href=c.toString()}},onError:i=>{var Y;console.error("Submission errors:",i),k(i),A(!0),M.dismiss(p);let c=t("submissionFailed"),l=null;i.tenant_signature?(c=t("signatureError")+": "+i.tenant_signature,l="signature-section",u(c)):i.property_images?(c=t("imageUploadError")+": "+i.property_images,l="property-images-section"):i.error&&(c=i.error,i.error.toLowerCase().includes("signature")&&(l="signature-section",u(c))),M.error(c),u(c),r&&(r.disabled=!1,r.textContent=t("submitRequest")),l&&((Y=document.getElementById(l))==null||Y.scrollIntoView({behavior:"smooth",block:"center"}))}})},ve=()=>{var s;g==="draw"?((s=y.current)==null||s.clear(),w("tenant_signature","")):w("signature_file",null),u("")},Ne=s=>{const r=s.target.files[0];if(r&&!r.type.startsWith("image/")){u("Please upload a valid image file");return}w("signature_file",r),u("")},I=s=>z&&b[s]||xe[s],we=s=>{w("tenant_signature",s),console.log("Signature saved from component:",s.substring(0,30)+"..."),u("")};return e.jsxs(Ee,{children:[e.jsx(Me,{title:t("formTitle"),children:e.jsx("style",{children:`
                        .draggable-modal {
                            position: fixed;
                            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
                            border-radius: 0.5rem;
                            background-color: white;
                            z-index: 50;
                            overflow: hidden;
                            max-width: 28rem;
                            width: 100%;
                        }
                        
                        .modal-header {
                            cursor: move;
                            user-select: none;
                            display: flex;
                            align-items: center;
                            padding-bottom: 12px;
                        }
                    `})}),D?e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsx("div",{className:"p-6 bg-white border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})})})})}):e.jsx("div",{className:"py-12 bg-gray-100",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white shadow-lg border border-gray-200 sm:rounded-lg p-8",children:[e.jsx("h2",{className:"text-2xl font-serif font-bold text-center text-gray-800 mb-4",children:t("formTitle")}),e.jsx("p",{className:"text-center text-gray-600 mb-8",children:t("formInstructions")}),e.jsxs("form",{onSubmit:_e,className:"space-y-8",noValidate:!0,children:[e.jsxs("section",{className:"border-b border-gray-300 pb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-serif font-medium text-gray-700",children:t("propertyInfo")}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t("date"),": ",new Date().toLocaleDateString(o==="es"?"es-ES":"en-US",{timeZone:"America/Los_Angeles"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"building_name",value:t("building"),className:"font-medium"}),e.jsx(W,{id:"building_name",type:"text",name:"building_name",value:n.building_name,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("building_name",s.target.value),required:!0,placeholder:t("buildingPlaceholder"),"aria-describedby":"building_name-error"}),e.jsx(q,{id:"building_name-error",message:t(I("building_name")),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"unit_number",value:t("unit"),className:"font-medium"}),e.jsx(W,{id:"unit_number",type:"text",name:"unit_number",value:n.unit_number,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("unit_number",s.target.value),required:!0,placeholder:t("unitPlaceholder"),"aria-describedby":"unit_number-error"}),e.jsx(q,{id:"unit_number-error",message:t(I("unit_number")),className:"mt-2"})]})]})]}),e.jsxs("section",{className:"border-b border-gray-300 pb-6",children:[e.jsx("h3",{className:"text-lg font-serif font-medium text-gray-700 mb-4",children:t("tenantInfo")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tenant_name",value:t("name"),className:"w-32 inline-block font-medium"}),e.jsx(W,{id:"tenant_name",type:"text",name:"tenant_name",value:n.tenant_name,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("tenant_name",s.target.value),required:!0,"aria-describedby":"tenant_name-error"}),e.jsx(q,{id:"tenant_name-error",message:t(I("tenant_name")),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tenant_phone",value:t("phone"),className:"w-32 inline-block font-medium"}),e.jsx(W,{id:"tenant_phone",type:"tel",name:"tenant_phone",value:n.tenant_phone,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("tenant_phone",s.target.value),required:!0,"aria-describedby":"tenant_phone-error"}),e.jsx(q,{id:"tenant_phone-error",message:t(I("tenant_phone")),className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"tenant_email",value:t("email"),className:"w-32 inline-block font-medium"}),e.jsx(W,{id:"tenant_email",type:"email",name:"tenant_email",value:n.tenant_email,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("tenant_email",s.target.value),required:!0,"aria-describedby":"tenant_email-error"}),e.jsx(q,{id:"tenant_email-error",message:t(I("tenant_email")),className:"mt-2"})]})]})]}),e.jsxs("section",{className:"border-b border-gray-300 pb-6",children:[e.jsx("h3",{className:"text-lg font-serif font-medium text-gray-700 mb-4",children:t("schedulingAccess")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"scheduled_date",value:t("preferredDate"),className:"w-32 inline-block font-medium"}),e.jsx(W,{id:"scheduled_date",type:"date",name:"scheduled_date",value:n.scheduled_date,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("scheduled_date",s.target.value),required:!0,min:new Date().toISOString().split("T")[0],onInput:s=>{if(s.target.value)try{const r=`${s.target.value}T00:00:00`,i=new Date(r).getDay();console.log("Selected date:",s.target.value),console.log("Day of week:",i,"(0=Sunday, 1=Monday, ..., 6=Saturday)"),i===0||i===6?(console.log("Weekend detected, clearing input"),s.target.value="",M.error(t("weekendNotAllowed")),F("scheduled_date","")):console.log("Weekday selected:",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][i])}catch(r){console.error("Date parsing error:",r)}},"aria-describedby":"scheduled_date-error"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("weekdaysOnly")}),e.jsx(q,{id:"scheduled_date-error",message:t(I("scheduled_date")),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"scheduled_time",value:t("preferredTime"),className:"w-32 inline-block font-medium"}),e.jsx(W,{id:"scheduled_time",type:"time",name:"scheduled_time",value:n.scheduled_time,className:"mt-1 w-full border-0 border-b-2 border-gray-300 focus:border-indigo-500 focus:ring-0 bg-transparent",onChange:s=>F("scheduled_time",s.target.value),required:!0,min:"09:00",max:"17:00",step:"1800",onInput:s=>{if(s.target.value)try{const r=s.target.value,[p,i]=r.split(":").map(Number);console.log("Selected time:",r),console.log("Hours:",p,"Minutes:",i),p<9||p>17||p===17&&i>0?(console.log("Invalid time detected, clearing input"),s.target.value="",M.error(t("timeNotAllowed")),F("scheduled_time","")):console.log("Valid time selected")}catch(r){console.error("Time parsing error:",r)}},"aria-describedby":"scheduled_time-error"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("businessHours")}),e.jsx(q,{id:"scheduled_time-error",message:t(I("scheduled_time")),className:"mt-2"})]})]}),e.jsxs("div",{children:[e.jsx(E,{value:t("permissionToEnter"),className:"font-medium"}),e.jsxs("div",{className:"flex gap-6 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"permission_to_enter",checked:n.permission_to_enter,onChange:()=>ne(!0),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("yes")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"permission_to_enter",checked:!n.permission_to_enter,onChange:()=>ne(!1),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("no")})]})]}),e.jsx(q,{message:t(I("permission_to_enter")),className:"mt-2"})]})]})]}),e.jsxs("section",{className:"border-b border-gray-300 pb-6",children:[e.jsx("h3",{className:"text-lg font-serif font-medium text-gray-700 mb-4",children:t("workRequest")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"work_requested",value:t("workRequested"),className:"w-32 inline-block font-medium"}),e.jsx(J,{id:"work_requested",name:"work_requested",value:n.work_requested,className:"mt-1 w-full border border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500 bg-white",onChange:s=>F("work_requested",s.target.value.slice(0,300)),required:!0,rows:3,maxLength:300,"aria-describedby":"work_requested-error"}),e.jsxs("div",{className:"flex justify-end mt-1 text-xs text-gray-500",children:[n.work_requested?n.work_requested.length:0,"/300"]}),e.jsx(q,{id:"work_requested-error",message:t(I("work_requested")),className:"mt-2"})]}),!x&&e.jsxs("div",{children:[e.jsx(E,{value:t("isEmergency"),className:"font-medium"}),e.jsxs("div",{className:"flex gap-6 mt-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"is_emergency",checked:n.is_emergency,onChange:()=>ie(!0),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("yes")})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"is_emergency",checked:!n.is_emergency,onChange:()=>ie(!1),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:t("no")})]})]}),e.jsx(q,{message:t(I("is_emergency")),className:"mt-2"})]}),e.jsx("div",{id:"property-images-section",children:e.jsx($e,{label:t("uploadPhotos"),images:n.property_images,onChange:s=>F("property_images",s),error:I("property_images"),required:!0,compressionOptions:me,t})}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"special_instructions",value:t("specialInstructions"),className:"w-32 inline-block font-medium"}),e.jsx(J,{id:"special_instructions",name:"special_instructions",value:n.special_instructions,className:"mt-1 w-full border border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500 bg-white",onChange:s=>F("special_instructions",s.target.value),rows:3,"aria-describedby":"special_instructions-error"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:t("optional")}),e.jsx(q,{id:"special_instructions-error",message:t(I("special_instructions")),className:"mt-2"})]})]})]}),e.jsxs("section",{id:"signature-section",className:"border-b border-gray-300 pb-6",children:[e.jsx("h3",{className:"text-lg font-serif font-medium text-gray-700 mb-4",children:t("signature")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>_("draw"),className:`px-4 py-2 rounded-md font-medium transition-colors ${g==="draw"?"bg-indigo-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,"aria-pressed":g==="draw",children:t("drawSignature")}),e.jsx("button",{type:"button",onClick:()=>_("upload"),className:`px-4 py-2 rounded-md font-medium transition-colors ${g==="upload"?"bg-indigo-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,"aria-pressed":g==="upload",children:t("uploadSignature")})]}),g==="draw"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("drawSignatureInstructions")}),e.jsx(Ie,{onSave:we,ref:y})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600",children:t("uploadSignatureInstructions")}),e.jsx("input",{type:"file",name:"signature_file",accept:"image/*",onChange:Ne,className:"mt-2 block w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100","aria-describedby":"signature_file-error"}),n.signature_file&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsxs("p",{className:"text-sm text-green-600",children:[t("selected")," ",n.signature_file.name]}),e.jsx("button",{type:"button",onClick:ve,className:"text-sm text-indigo-600 hover:text-indigo-800",children:t("clear")})]})]}),d&&e.jsx("p",{className:"text-sm text-red-600",id:"signature_file-error",children:d})]})]}),e.jsxs("section",{className:"bg-yellow-50 p-4 rounded-lg text-sm",children:[e.jsxs("h4",{className:"font-bold text-yellow-800",children:[t("important"),":"]}),e.jsx("p",{className:"text-yellow-700",children:t("submissionConfirmation")}),e.jsx("p",{className:"text-yellow-700 mt-2 font-medium",children:t("noCashPayments")})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Fe,{type:"submit",className:"px-8 py-3 text-lg font-medium bg-indigo-600 hover:bg-indigo-700 border-2 border-indigo-800 rounded-lg",disabled:K||f,"aria-busy":K,children:t(K?"submitting":"submitRequest")})})]})]})})}),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{ref:Z,className:"draggable-modal",style:{transform:`translate(${N.x}px, ${N.y}px)`,transition:U?"none":"transform 0.1s ease-out",cursor:U?"grabbing":"auto"},onMouseDown:ue,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-lg font-bold flex-grow",children:t("reasonForNoPermission")}),e.jsx("button",{onClick:ae,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t("reasonForNoPermissionExplanation")}),e.jsxs("div",{className:"mb-4",children:[e.jsx(E,{htmlFor:"no_permission_reason",value:t("reason"),className:"font-medium"}),e.jsx(J,{id:"no_permission_reason",name:"no_permission_reason",value:n.no_permission_reason,className:"mt-1 w-full border border-gray-300 rounded-md focus:border-indigo-500 focus:ring-indigo-500 bg-white",onChange:s=>w("no_permission_reason",s.target.value),required:!0,rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:ae,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:t("cancel")}),e.jsx("button",{type:"button",onClick:fe,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:t("submit")})]})]})})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{ref:H,className:"draggable-modal",style:{transform:`translate(${T.x}px, ${T.y}px)`,transition:h?"none":"transform 0.1s ease-out",cursor:h?"grabbing":"auto"},onMouseDown:ge,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-lg font-bold text-red-600 flex-grow",children:t("emergencyContact")}),e.jsx("button",{onClick:oe,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:t("emergencyInstructions")}),e.jsxs("p",{className:"text-base font-bold mb-6 text-center",children:[t("emergencyPhoneNumber"),": 213-531-9789"]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:oe,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50",children:t("cancel")}),e.jsx("button",{type:"button",onClick:be,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:t("continue")})]})]})})})]})}export{Ze as default};
